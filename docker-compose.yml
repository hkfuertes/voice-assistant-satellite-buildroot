services:
  satellite:
    build:
      context: .
      dockerfile: dockerfile.satellite
    devices:
      - /dev/snd:/dev/snd
    group_add:
      - audio
    ports:
      - "10700:10700"
    restart: unless-stopped
    command:
      - "--name"
      - "AssistPi"
      - "--uri"
      - "tcp://0.0.0.0:10700"
      - "--mic-command"
      - "arecord -D plughw:CARD=seeed2micvoicec,DEV=0 -r 16000 -c 1 -f S16_LE -t raw"
      - "--snd-command"
      - "aplay -D plughw:CARD=seeed2micvoicec,DEV=0 -r 22050 -c 1 -f S16_LE -t raw"
      - "--wake-uri"
      - "tcp://wakeword:10400"
      - "--wake-word-name"
      - "ok_nabu"
      - "--event-uri"
      - "tcp://leds:10500"
      - "--debug"
  wakeword:
    image: rhasspy/wyoming-openwakeword
    restart: unless-stopped
    ports:
      - 10400:10400
  leds:
    build:
      context: .
      dockerfile: dockerfile.leds
    ports:
      - 10500:10500
    devices:
      - /dev/gpiomem:/dev/gpiomem
    privileged: true
    restart: unless-stopped
    command:
      - "--uri"
      - "tcp://0.0.0.0:10500"
      - "--led-brightness"
      - "10"
