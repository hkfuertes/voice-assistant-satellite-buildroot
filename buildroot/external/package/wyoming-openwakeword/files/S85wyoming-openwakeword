#!/bin/sh

VENV_DIR="/opt/wyoming-openwakeword"
DAEMON="$VENV_DIR/bin/wyoming-openwakeword"
DAEMON_NAME="wyoming-openwakeword"
PIDFILE="/var/run/$DAEMON_NAME.pid"
LOGFILE="/var/log/$DAEMON_NAME.log"

start() {
	echo "Starting $DAEMON_NAME..."
	start-stop-daemon --start --quiet --background \
		--pidfile $PIDFILE \
		--make-pidfile \
		--name $DAEMON_NAME \
		--exec $DAEMON -- \
		--uri tcp://0.0.0.0:10400 \
		> $LOGFILE 2>&1
}

stop() {
	echo "Stopping $DAEMON_NAME..."
	start-stop-daemon --stop --quiet --pidfile $PIDFILE
	rm -f $PIDFILE
}

restart() {
	stop
	start
}

case "$1" in
	start)
		start
		;;
	stop)
		stop
		;;
	restart)
		restart
		;;
	*)
		echo "Usage: $0 {start|stop|restart}"
		exit 1
		;;
esac

exit $?
