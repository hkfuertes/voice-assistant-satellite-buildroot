# Mejor remuestreador por defecto (opcional)
defaults.pcm.rate_converter "samplerate"

# 1) Dispositivo HW de entrada (ajusta card/device si procede)
pcm.hw_in {
    type hw
    card 0
    device 0
}

# 2) Comparte el micro entre procesos
pcm.mic_shared {
    type dsnoop
    ipc_key 2048
    ipc_key_add_uid true
    slave {
        pcm "hw_in"
        channels 2
        rate 48000
        format S16_LE
    }
}

# 3) Mezcla estéreo a mono (L y R al 50%)
pcm.mic_mono {
    type route
    slave {
        pcm "mic_shared"
        channels 2
    }
    ttable {
        0.0 0.5   # L -> mono
        1.0 0.5   # R -> mono
    }
}

# 4) Entrega final para wake word: 16 kHz, 1 canal, S16_LE
pcm.wakeword {
    type plug
    slave {
        pcm "mic_mono"
        rate 16000
        channels 1
        format S16_LE
    }
}

# (Opcional) Deja el defecto del sistema apuntando a wakeword para captura.
# Si no quieres tocar el defecto, omite esta sección y usa -D wakeword en tu app.
pcm.!default {
    type asym
    playback.pcm "plughw:0"
    capture.pcm "wakeword"
}

ctl.!default {
    type hw
    card 0
}
